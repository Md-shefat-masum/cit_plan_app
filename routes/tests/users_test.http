### Variables
### NOTE: Token is automatically synced from token.txt
### To update: Run 'php routes/tests/scripts/update_token.php' or use VS Code task "Update Token in HTTP Test Files"
@baseUrl = http://localhost:8000
@apiUrl = {{baseUrl}}/api/v1/management/user-management/users
@token = 
### ============================================

### Get all users (Index)
GET {{apiUrl}}
Authorization: Bearer {{token}}
Content-Type: application/json

### Get all users with pagination
GET {{apiUrl}}?per_page=10&page=1
Authorization: Bearer {{token}}
Content-Type: application/json

### Get all users with search filter (searches all fields)
GET {{apiUrl}}?search=john
Authorization: Bearer {{token}}
Content-Type: application/json

### Get all users with status filter
GET {{apiUrl}}?status=1
Authorization: Bearer {{token}}
Content-Type: application/json

### Get all users with custom fields
GET {{apiUrl}}?fields[]=id&fields[]=username&fields[]=email&fields[]=user_role_title&fields[]=creator_name
Authorization: Bearer {{token}}
Content-Type: application/json

### Get all users with ordering
GET {{apiUrl}}?orderByCol=username&orderByAsc=1
Authorization: Bearer {{token}}
Content-Type: application/json

### Get a specific user by ID
GET {{apiUrl}}/1
Authorization: Bearer {{token}}
Content-Type: application/json

### Create a new user (Store)
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "John Doe",
    "username": "johndoe",
    "email": "john.doe@example.com",
    "user_role_id": 1,
    "password": "password123",
    "password_confirmation": "password123",
    "status": 1
}

### Create a new user - Inactive
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "Jane Smith",
    "username": "janesmith",
    "email": "jane.smith@example.com",
    "user_role_id": 2,
    "password": "password123",
    "password_confirmation": "password123",
    "status": 0
}

### Update a user (without password)
POST {{apiUrl}}/update
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "id": 1,
    "name": "John Doe Updated",
    "username": "johndoe_updated",
    "email": "john.updated@example.com",
    "user_role_id": 1,
    "status": 1
}

### Update a user (with password change)
POST {{apiUrl}}/update
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "id": 1,
    "name": "John Doe",
    "username": "johndoe",
    "email": "john.doe@example.com",
    "user_role_id": 1,
    "password": "newpassword123",
    "password_confirmation": "newpassword123",
    "status": 1
}

### Soft delete a user (set status = 0)
POST {{apiUrl}}/soft-delete
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "id": 1
}

### Restore a user (set status = 1)
POST {{apiUrl}}/restore
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "id": 1
}

### Destroy a user (permanent delete - use with caution)
POST {{apiUrl}}/destroy
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "id": 1
}

### Import users
POST {{apiUrl}}/import
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "data": [
        {
            "name": "User One",
            "username": "userone",
            "email": "userone@example.com",
            "user_role_id": 1,
            "password": "password123",
            "status": 1
        },
        {
            "name": "User Two",
            "username": "usertwo",
            "email": "usertwo@example.com",
            "user_role_id": 2,
            "password": "password123",
            "status": 1
        }
    ]
}

### Get analytics data
GET {{apiUrl}}/analytics
Authorization: Bearer {{token}}
Content-Type: application/json

### VALIDATION ERROR TESTS
### ============================================

### Validation Error: Missing name
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "username": "testuser",
    "email": "test@example.com",
    "user_role_id": 1,
    "password": "password123",
    "password_confirmation": "password123"
}

### Validation Error: Missing username
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "Test User",
    "email": "test@example.com",
    "user_role_id": 1,
    "password": "password123",
    "password_confirmation": "password123"
}

### Validation Error: Missing user_role_id
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "Test User",
    "username": "testuser",
    "email": "test@example.com",
    "password": "password123",
    "password_confirmation": "password123"
}

### Validation Error: Missing password
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "Test User",
    "username": "testuser",
    "email": "test@example.com",
    "user_role_id": 1
}

### Validation Error: Password confirmation mismatch
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "Test User",
    "username": "testuser",
    "email": "test@example.com",
    "user_role_id": 1,
    "password": "password123",
    "password_confirmation": "differentpassword"
}

### Validation Error: Duplicate username
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "Test User",
    "username": "johndoe",
    "email": "test2@example.com",
    "user_role_id": 1,
    "password": "password123",
    "password_confirmation": "password123"
}

### Validation Error: Duplicate email
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "Test User",
    "username": "testuser2",
    "email": "john.doe@example.com",
    "user_role_id": 1,
    "password": "password123",
    "password_confirmation": "password123"
}

### Validation Error: Invalid user_role_id
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "Test User",
    "username": "testuser",
    "email": "test@example.com",
    "user_role_id": 99999,
    "password": "password123",
    "password_confirmation": "password123"
}

### Validation Error: Name too long (max 50)
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "This is a very long name that exceeds the maximum allowed length of 50 characters",
    "username": "testuser",
    "email": "test@example.com",
    "user_role_id": 1,
    "password": "password123",
    "password_confirmation": "password123"
}

### Validation Error: Username too long (max 20)
POST {{apiUrl}}/store
Authorization: Bearer {{token}}
Content-Type: application/json

{
    "name": "Test User",
    "username": "thisusernameistoolong",
    "email": "test@example.com",
    "user_role_id": 1,
    "password": "password123",
    "password_confirmation": "password123"
}

### NOTES
### ============================================
### 1. Password is required on create
### 2. Password is optional on update - only required if password field is provided
### 3. If password is provided, password_confirmation is required
### 4. Slug is automatically set from username
### 5. Creator is automatically set from authenticated user
### 6. Users should be soft deleted (status = 0) rather than destroyed
### 7. Index returns: id, user_role_id, user_role_title, username, email, creator, creator_name, status, slug, created_at, updated_at
### 8. Search works on all fields: id, username, email, name, slug, user_role_title, creator_name
